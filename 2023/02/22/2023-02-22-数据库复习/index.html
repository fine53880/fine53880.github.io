<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>数据库复习 | Strawberry</title><meta name="author" content="Fine"><meta name="copyright" content="Fine"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="数据库复习 创建数据库  12 codeCREATE DATABASE mydatabase;  该语句创建了一个名为mydatabase的新数据库。  删除数据库  12 DROP DATABASE mydatabase;  该语句删除了名为mydatabase的数据库。  选择数据库  12 USE mydatabase;  该语句选择了名为mydatabase的数据库作为当前数据库。">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库复习">
<meta property="og:url" content="http://example.com/2023/02/22/2023-02-22-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0/index.html">
<meta property="og:site_name" content="Strawberry">
<meta property="og:description" content="数据库复习 创建数据库  12 codeCREATE DATABASE mydatabase;  该语句创建了一个名为mydatabase的新数据库。  删除数据库  12 DROP DATABASE mydatabase;  该语句删除了名为mydatabase的数据库。  选择数据库  12 USE mydatabase;  该语句选择了名为mydatabase的数据库作为当前数据库。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/-https:/source.fomal.cc/img/default_cover_11.webp">
<meta property="article:published_time" content="2023-02-22T09:40:00.000Z">
<meta property="article:modified_time" content="2023-02-22T04:54:13.886Z">
<meta property="article:author" content="Fine">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/-https:/source.fomal.cc/img/default_cover_11.webp"><link rel="shortcut icon" href="/2.jpg"><link rel="canonical" href="http://example.com/2023/02/22/2023-02-22-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据库复习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-22 12:54:13'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://q2.qlogo.cn/headimg_dl?dst_uin=1493199807&amp;spec=100" onerror="onerror=null;src='https://source.fomal.cc/img/default_cover_10.webp'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/-https:/source.fomal.cc/img/default_cover_11.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Strawberry</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">数据库复习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2023-02-22T09:40:00.000Z" title="发表于 2023-02-22 17:40:00">2023-02-22</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><span id="more"></span>

<h1 id="数据库复习"><a href="#数据库复习" class="headerlink" title="数据库复习"></a>数据库复习</h1><ol>
<li>创建数据库</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> code</span><br><span class="line">CREATE DATABASE mydatabase;</span><br></pre></td></tr></table></figure>

<p>该语句创建了一个名为mydatabase的新数据库。</p>
<ol>
<li>删除数据库</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">DROP DATABASE mydatabase;</span><br></pre></td></tr></table></figure>

<p>该语句删除了名为mydatabase的数据库。</p>
<ol>
<li>选择数据库</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">USE mydatabase;</span><br></pre></td></tr></table></figure>

<p>该语句选择了名为mydatabase的数据库作为当前数据库。</p>
<ol>
<li>创建表</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> CREATE TABLE users (</span><br><span class="line">    id INT PRIMARY KEY,</span><br><span class="line">    name VARCHAR(50),</span><br><span class="line">    email VARCHAR(100)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>该语句创建了一个名为users的数据表，包含了id、name和email列。</p>
<ol>
<li>插入数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> INSERT INTO users (id, name, email)</span><br><span class="line">VALUES ( , &#x27;John Doe&#x27;, &#x27;john.doe@example.com&#x27;);</span><br></pre></td></tr></table></figure>

<p>该语句向users表中插入了一条记录，其中id为 ，name为John Doe，email为<a href="mailto:john.doe@example.com">john.doe@example.com</a>。</p>
<ol>
<li>查询数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">SELECT * FROM users;</span><br></pre></td></tr></table></figure>

<p>该语句查询了users表中的所有记录，并返回所有列的数据。</p>
<ol>
<li>更新数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> UPDATE users</span><br><span class="line">SET email = &#x27;jane.doe@example.com&#x27;</span><br><span class="line">WHERE id = 2;</span><br></pre></td></tr></table></figure>

<p>该语句将id为2的记录的email列更新为<a href="mailto:jane.doe@example.com">jane.doe@example.com</a>。</p>
<ol>
<li>删除数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">DELETE FROM users WHERE id = 3;</span><br></pre></td></tr></table></figure>

<p>该语句删除了id为3的记录。</p>
<ol>
<li>视图：</li>
</ol>
<p>例如，我们有一个名为customers的数据表，其中包含了id、name、email等列，我们可以使用以下语句创建一个基于这个数据表的视图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeCREATE VIEW customer_info AS</span><br><span class="line">SELECT id, name, email</span><br><span class="line">FROM customers</span><br><span class="line">WHERE age &gt; 18;</span><br></pre></td></tr></table></figure>

<p>该语句创建了一个名为customer_info的视图，包含了customers表中满足age &gt; 18的记录的id、name和email列。</p>
<ol>
<li>存储过程：</li>
</ol>
<p>例如，我们可以创建一个简单的存储过程来计算两个整数的和：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeCREATE PROCEDURE add_numbers (IN a INT, IN b INT)</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE sum INT;</span><br><span class="line">    SET sum = a + b;</span><br><span class="line">    SELECT sum;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>该存储过程名称为add_numbers，接受两个整数类型的输入参数a和b，声明一个整数类型的变量sum，将a和b相加并将结果存储到sum中，最后使用SELECT语句返回sum的值。</p>
<ol>
<li>触发器：</li>
</ol>
<p>例如，我们可以创建一个名为log_changes的触发器，用于在每次更新users表的时候，将修改操作记录到另一个名为user_log的数据表中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeCREATE TRIGGER log_changes</span><br><span class="line">AFTER UPDATE ON users</span><br><span class="line">FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">    INSERT INTO user_log (user_id, change_type, change_date)</span><br><span class="line">    VALUES (OLD.id, &#x27;update&#x27;, NOW());</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>该触发器名称为log_changes，触发器基于每一行的UPDATE事件，将更新操作的用户ID、修改类型和时间记录到user_log表中。</p>
<ol>
<li>事件：</li>
</ol>
<p>例如，我们可以创建一个名为backup_database的事件，每天晚上12点备份我们的数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeCREATE EVENT backup_database</span><br><span class="line">ON SCHEDULE</span><br><span class="line">    EVERY   DAY</span><br><span class="line">    STARTS CURRENT_TIMESTAMP + INTERVAL   DAY</span><br><span class="line">    ON COMPLETION PRESERVE</span><br><span class="line">DO</span><br><span class="line">    CALL backup_database();</span><br></pre></td></tr></table></figure>

<p>该事件名称为backup_database，使用ON SCHEDULE语句定义了事件的执行计划，使用DO语句指定了事件的逻辑代码。在本例中，事件每天晚上12点启动，并调用一个名为backup_database的存储过程来执行备份操作。</p>
<ol>
<li>内连接查询（INNER JOIN）</li>
</ol>
<p>内连接查询返回两个表中匹配的行，只有在两个表中都有匹配的行时才会返回结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT *</span><br><span class="line">FROM table1</span><br><span class="line">INNER JOIN table2</span><br><span class="line">ON table1.column_name = table2.column_name;</span><br></pre></td></tr></table></figure>

<p>该语句将table1和table2两个表内连接查询，并且只返回它们之间column_name列值相等的行。</p>
<ol>
<li>左连接查询（LEFT JOIN）</li>
</ol>
<p>左连接查询返回左表中的所有行，以及在右表中有匹配的行，如果右表中没有匹配的行，则返回NULL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT *</span><br><span class="line">FROM table1</span><br><span class="line">LEFT JOIN table2</span><br><span class="line">ON table1.column_name = table2.column_name;</span><br></pre></td></tr></table></figure>

<p>该语句将table1和table2两个表左连接查询，并返回所有table1中的行，以及它们与table2中column_name列值相等的行，如果没有匹配的行则返回NULL。</p>
<ol>
<li>右连接查询（RIGHT JOIN）</li>
</ol>
<p>右连接查询与左连接查询类似，不同之处在于它返回右表中的所有行，以及在左表中有匹配的行，如果左表中没有匹配的行，则返回NULL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT *</span><br><span class="line">FROM table1</span><br><span class="line">RIGHT JOIN table2</span><br><span class="line">ON table1.column_name = table2.column_name;</span><br></pre></td></tr></table></figure>

<p>该语句将table1和table2两个表右连接查询，并返回所有table2中的行，以及它们与table1中column_name列值相等的行，如果没有匹配的行则返回NULL。</p>
<ol>
<li>全连接查询（FULL OUTER JOIN）</li>
</ol>
<p>全连接查询返回左右两个表中的所有行，如果左表或右表中没有匹配的行，则返回NULL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT *</span><br><span class="line">FROM table1</span><br><span class="line">FULL OUTER JOIN table2</span><br><span class="line">ON table1.column_name = table2.column_name;</span><br></pre></td></tr></table></figure>

<p>该语句将table1和table2两个表全连接查询，并返回所有它们中的行，以及它们之间column_name列值相等的行，如果没有匹配的行则返回NULL。需要注意的是，MySQL并不支持全连接查询，但可以使用LEFT JOIN和RIGHT JOIN的组合来模拟实现。</p>
<p>一些常用函数的例子</p>
<p>MySQL提供了大量的内置函数来操作和处理数据。以下是一些常用函数及其例子：</p>
<ol>
<li>COUNT()</li>
</ol>
<p>COUNT()函数用于统计表中行数或指定列中非NULL值的数量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT COUNT(*)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中的行数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT COUNT(column_name)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中column_name列中非NULL值的数量。</p>
<ol>
<li>SUM()</li>
</ol>
<p>SUM()函数用于计算指定列中所有值的总和。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT SUM(column_name)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中column_name列中所有值的总和。</p>
<ol>
<li>AVG()</li>
</ol>
<p>AVG()函数用于计算指定列中所有值的平均值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT AVG(column_name)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中column_name列中所有值的平均值。</p>
<ol>
<li>MAX()</li>
</ol>
<p>MAX()函数用于返回指定列中的最大值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT MAX(column_name)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中column_name列中的最大值。</p>
<ol>
<li>MIN()</li>
</ol>
<p>MIN()函数用于返回指定列中的最小值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT MIN(column_name)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中column_name列中的最小值。</p>
<ol>
<li>CONCAT()</li>
</ol>
<p>CONCAT()函数用于将两个或多个字符串连接成一个字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT CONCAT(column1, &#x27; &#x27;, column2)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中column1和column2列连接起来的字符串，中间用空格隔开。</p>
<ol>
<li>SUBSTRING()</li>
</ol>
<p>SUBSTRING()函数用于返回字符串的一部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT SUBSTRING(column_name, start, length)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中column_name列从start位置开始，长度为length的字符串部分。</p>
<ol>
<li>NOW()</li>
</ol>
<p>NOW()函数用于返回当前的日期和时间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scssCopy code</span><br><span class="line">SELECT NOW()</span><br></pre></td></tr></table></figure>

<p>该语句将返回当前的日期和时间。</p>
<ol>
<li>DATE_FORMAT()</li>
</ol>
<p>DATE_FORMAT()函数用于将日期格式化为指定的字符串格式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlCopy codeSELECT DATE_FORMAT(date_column, &#x27;%Y-%m-%d&#x27;)</span><br><span class="line">FROM table;</span><br></pre></td></tr></table></figure>

<p>该语句将返回table表中date_column列的日期以YYYY-MM-DD的格式显示。</p>
<h2 id="第十四章-事务与MySql的多用户并发控制"><a href="#第十四章-事务与MySql的多用户并发控制" class="headerlink" title="第十四章 事务与MySql的多用户并发控制"></a>第十四章 事务与MySql的多用户并发控制</h2><h3 id="MySQL的事务"><a href="#MySQL的事务" class="headerlink" title=".MySQL的事务"></a>.MySQL的事务</h3><p>MySQL的事务是一组关联的数据库操作，这些操作作为单个逻辑单元执行，要么全部执行，要么全部回滚（撤销）到之前的状态。MySQL使用ACID属性来确保事务的可靠性和一致性，即原子性、一致性、隔离性和持久性。</p>
<ol>
<li>原子性：事务是一个原子性的操作单元，意味着所有操作要么全部执行成功，要么全部失败。如果其中任何一个操作失败，则整个事务将回滚（撤销）到之前的状态，以确保数据的一致性。</li>
<li>一致性：在事务开始和结束之间，数据库将处于一致的状态。这意味着所有的数据约束、触发器和外键约束都得到满足，并且数据库内的所有数据都符合定义的规则。</li>
<li>隔离性：MySQL的事务是隔离的，这意味着每个事务都必须与其他事务相互独立。每个事务都应该不受其他事务的干扰，以确保数据的完整性。</li>
<li>持久性：一旦事务完成并且提交成功，数据库中的数据应该是永久的，并且不会被任何系统故障所破坏。</li>
</ol>
<p>MySQL提供了多种事务隔离级别，包括Read Uncommitted（读取未提交的数据）、Read Committed（读取提交的数据）、Repeatable Read（可重复读取）和Serializable（串行化）。不同的隔离级别会影响并发操作的能力和性能，因此选择正确的隔离级别非常重要。</p>
<h6 id="读取未提交的数据"><a href="#读取未提交的数据" class="headerlink" title="读取未提交的数据"></a>读取未提交的数据</h6><p>读取未提交的数据是MySQL的一种事务隔离级别，它是最低级别的隔离级别。在这个级别下，一个事务可以读取另一个事务未提交的数据。这意味着，如果一个事务正在对某个数据进行修改，而另一个事务在此同时读取同样的数据，那么第二个事务将会读取到第一个事务未提交的修改数据。这可能会导致数据的不一致性，因为第一个事务可能会回滚，从而导致第二个事务读取到的数据并不准确。</p>
<p>读取未提交的数据通常用于一些不需要高度数据一致性的场景，例如一些数据仅作为参考信息的场景。但是，如果应用程序需要保证数据的完整性和一致性，则不应该使用读取未提交的数据隔离级别。</p>
<p>要将事务隔离级别设置为读取未提交的数据，可以在开始事务之前使用以下SQL命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line">START TRANSACTION;</span><br></pre></td></tr></table></figure>

<p>或者可以在创建连接时设置隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，读取未提交的数据隔离级别可能会导致脏读（Dirty Read）和幻读（Phantom Read）问题。脏读是指一个事务读取到了另一个事务未提交的数据，而幻读是指一个事务在同一个查询中多次读取数据时，结果集不一致。因此，不建议在高并发环境下使用读取未提交的数据隔离级别。</p>
<h6 id="读取提交的数据"><a href="#读取提交的数据" class="headerlink" title="读取提交的数据"></a>读取提交的数据</h6><p>读取提交的数据是MySQL的一种事务隔离级别，它比读取未提交的数据更严格。在这个级别下，一个事务只能读取另一个事务已经提交的数据。这可以避免脏读（Dirty Read）问题，确保读取到的数据是一致的。</p>
<p>读取提交的数据隔离级别是MySQL的默认隔离级别。要将事务隔离级别设置为读取提交的数据，可以在开始事务之前使用以下SQL命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> SET TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line">START TRANSACTION;</span><br></pre></td></tr></table></figure>

<p>或者可以在创建连接时设置隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，读取提交的数据隔离级别可能会导致不可重复读（Non-repeatable Read）问题。不可重复读是指在同一个事务中，多次读取同一个数据时，结果不一致。这是因为另一个事务可能会在两次读取之间修改了该数据。如果应用程序需要保证数据的完整性和一致性，但同时需要更高的并发性能，则可以考虑使用更高级别的隔离级别，例如可重复读取或串行化。</p>
<h6 id="可重复读取"><a href="#可重复读取" class="headerlink" title="可重复读取"></a>可重复读取</h6><p>可重复读取是MySQL的一种事务隔离级别，它比读取提交的数据更严格。在这个级别下，一个事务开始后，不会受到其他事务的影响，即使其他事务在这个事务运行期间修改了相同的数据，也不会对这个事务的结果产生影响。也就是说，一个事务可以多次读取相同的数据，得到的结果都是一致的。</p>
<p>为了实现可重复读取隔离级别，MySQL使用了多版本并发控制（MVCC）机制。在MVCC机制下，每次对数据库进行修改时，不会直接覆盖原来的数据，而是创建一个新版本的数据，并将新版本的数据存储到一个临时的位置中。这样，其他事务仍然可以访问旧版本的数据，而不会受到正在修改的事务的影响。只有在事务提交后，才会将新版本的数据正式保存到数据库中。</p>
<p>可重复读取隔离级别可以通过以下SQL命令设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line">START TRANSACTION;</span><br></pre></td></tr></table></figure>

<p>或者可以在创建连接时设置隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，可重复读取隔离级别可能会导致幻读（Phantom Read）问题。幻读是指在同一个事务中，多次执行相同的查询时，结果集不一致。这是因为其他事务可能会在两次查询之间插入了新的数据。如果应用程序需要保证更高的数据一致性，则可以考虑使用更高级别的隔离级别，例如串行化。</p>
<h6 id="串行化"><a href="#串行化" class="headerlink" title="串行化"></a>串行化</h6><p>串行化是MySQL的最高事务隔离级别，它确保所有的事务互不干扰，以串行化的方式执行，因此可以避免所有的并发问题。在串行化隔离级别下，所有的事务必须按照其提交的顺序执行，每个事务只有在上一个事务完全结束后才能开始执行。</p>
<p>为了实现串行化隔离级别，MySQL使用了严格的锁定机制，保证每个事务只能在一个时刻执行。在串行化隔离级别下，当一个事务读取或修改数据时，会对相关的数据对象进行锁定，直到该事务结束后才会释放锁。</p>
<p>串行化隔离级别可以通过以下SQL命令设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line">START TRANSACTION;</span><br></pre></td></tr></table></figure>

<p>或者可以在创建连接时设置隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，串行化隔离级别会降低数据库的并发性能，因为它会限制同时执行的事务数量。因此，只有在应用程序需要高度数据一致性，而且并发性能不是最重要的时候，才应该使用串行化隔离级别。</p>
<h3 id="2-MySQL事务控制语句"><a href="#2-MySQL事务控制语句" class="headerlink" title="2.MySQL事务控制语句"></a>2.MySQL事务控制语句</h3><p>MySQL提供了以下事务控制语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> . START TRANSACTION：开始一个事务。</span><br><span class="line">2. COMMIT：提交一个事务，将所有的修改保存到数据库中。</span><br><span class="line">3. ROLLBACK：回滚一个事务，撤销所有的修改。</span><br><span class="line">4. SAVEPOINT：设置一个保存点，在事务执行过程中可以回滚到该保存点之前的状态。</span><br><span class="line">5. ROLLBACK TO SAVEPOINT：回滚到指定的保存点，撤销该保存点之后的所有修改。</span><br></pre></td></tr></table></figure>

<p>这些事务控制语句用于管理事务的执行，确保事务的原子性、一致性、隔离性和持久性。当使用事务控制语句时，需要注意以下几点：</p>
<ol>
<li>执行事务控制语句时，必须处于一个已经开始的事务中。</li>
<li>在一个事务中，只能执行一个COMMIT或ROLLBACK语句。</li>
<li>在一个事务中，可以执行多个SAVEPOINT和ROLLBACK TO SAVEPOINT语句。</li>
<li>在使用SAVEPOINT和ROLLBACK TO SAVEPOINT语句时，保存点的名称必须是唯一的，并且不区分大小写。</li>
</ol>
<p>下面是一个示例，展示如何使用MySQL的事务控制语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">START TRANSACTION;</span><br><span class="line"></span><br><span class="line">INSERT INTO customers (name, email) VALUES (&#x27;Alice&#x27;, &#x27;alice@example.com&#x27;);</span><br><span class="line"></span><br><span class="line">SAVEPOINT savepoint1;</span><br><span class="line"></span><br><span class="line">INSERT INTO orders (customer_id, total) VALUES ( , 100);</span><br><span class="line"></span><br><span class="line">SAVEPOINT savepoint2;</span><br><span class="line"></span><br><span class="line">INSERT INTO order_items (order_id, product, quantity) VALUES ( , &#x27;Widget&#x27;, 2);</span><br><span class="line"></span><br><span class="line">ROLLBACK TO SAVEPOINT savepoint2;</span><br><span class="line"></span><br><span class="line">INSERT INTO order_items (order_id, product, quantity) VALUES ( , &#x27;Gizmo&#x27;, 3);</span><br><span class="line"></span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们开始了一个事务，并插入了一个新的客户。然后，我们设置了一个保存点savepoint1，并插入了一个新的订单。接着，我们设置了另一个保存点savepoint2，并插入了一个新的订单项。然后，我们回滚到savepoint2保存点之前的状态，撤销了我们之前插入的订单项。最后，我们插入了另一个订单项，并提交了整个事务。</p>
<h3 id="3-事务的隔离性级别"><a href="#3-事务的隔离性级别" class="headerlink" title="3.事务的隔离性级别"></a>3.事务的隔离性级别</h3><p>MySQL支持四种事务隔离性级别，它们分别是：</p>
<ol>
<li>读未提交（Read Uncommitted）：最低的隔离级别，允许一个事务读取另一个事务未提交的数据。</li>
<li>读已提交（Read Committed）：默认的隔离级别，一个事务只能读取另一个事务已提交的数据。</li>
<li>可重复读（Repeatable Read）：确保一个事务执行期间多次读取同一数据时，得到的结果始终相同，不受其他并发事务的影响。</li>
<li>串行化（Serializable）：最高的隔离级别，保证所有的事务串行执行，避免任何并发问题。</li>
</ol>
<p>这些隔离级别通过MySQL的事务隔离级别设置来控制，可以使用以下SQL语句来设置隔离级别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">SET TRANSACTION ISOLATION LEVEL &lt;isolation level&gt;;</span><br></pre></td></tr></table></figure>

<p>其中，<isolation level>可以是READ UNCOMMITTED、READ COMMITTED、REPEATABLE READ或SERIALIZABLE。</isolation></p>
<p>需要注意的是，隔离级别越高，数据库的并发性能就越低，因为高隔离级别通常需要使用更多的锁定和资源占用，从而导致更多的阻塞和等待。因此，在选择隔离级别时，需要根据应用程序的需求进行权衡。</p>
<h3 id="4-MySQL并发控制"><a href="#4-MySQL并发控制" class="headerlink" title="4.MySQL并发控制"></a>4.MySQL并发控制</h3><p>MySQL并发控制是指在多个事务同时访问数据库时，保证数据的正确性和一致性的机制。MySQL提供了多种并发控制机制，包括锁定、MVCC（多版本并发控制）和信号量等。</p>
<ol>
<li>锁定机制：MySQL支持两种锁定机制：共享锁（S锁）和排他锁（X锁）。S锁允许多个事务同时读取同一数据，但不允许写入操作；X锁则不允许其他事务读取或写入同一数据。在MySQL中，锁定机制主要通过表锁、行锁和间隙锁来实现。</li>
<li>MVCC机制：MySQL使用MVCC机制来支持可重复读和串行化隔离级别。MVCC通过在每个数据行中保存多个版本来实现事务隔离。每个版本都有一个时间戳，事务在读取数据时只会看到早于其自身时间戳的数据版本。如果在同一数据行上存在多个事务并发修改，MySQL将使用回滚段来存储旧版本数据，并使用MVCC来读取正确的数据版本。</li>
<li>信号量机制：MySQL还提供了信号量机制来控制并发访问。信号量是一种计数器，用于控制同时访问数据库的连接数。MySQL使用wait_timeout和max_connections参数来控制连接超时和最大连接数。如果超过了最大连接数，MySQL将拒绝新连接请求。</li>
</ol>
<p>需要注意的是，并发控制机制需要消耗大量的系统资源，因此，在实现并发控制时需要根据实际情况进行权衡。同时，不同的并发控制机制也适用于不同的业务场景，开发人员需要根据实际情况选择合适的机制。</p>
<h3 id="5-锁的概述"><a href="#5-锁的概述" class="headerlink" title="5.锁的概述"></a>5.锁的概述</h3><p>在数据库中，锁是一种用于控制并发访问的机制，它可以确保在多个事务同时访问数据库时，数据的正确性和一致性。锁可以保证在同一时间只有一个事务能够访问某个数据，防止数据出现冲突。</p>
<p>锁可以分为悲观锁和乐观锁两种：</p>
<ol>
<li>悲观锁：悲观锁假设数据在大多数时间内都是被其他事务访问的，因此，在读取或更新数据时，先获取锁，确保其他事务无法访问该数据。MySQL中的行锁和表锁就是一种悲观锁。</li>
<li>乐观锁：乐观锁假设数据在大多数时间内都是不会被其他事务访问的，因此，在更新数据时，不会直接获取锁，而是先读取数据，然后更新数据，如果在更新数据时发现数据已经被其他事务更新，则回滚操作。MySQL中的MVCC就是一种乐观锁。</li>
</ol>
<p>锁还可以分为共享锁和排他锁两种：</p>
<ol>
<li>共享锁：共享锁允许多个事务同时读取同一数据，但不允许写入操作。共享锁可以防止其他事务对该数据的写入操作，但允许其他事务对该数据的读取操作。MySQL中的共享锁是一种行锁。</li>
<li>排他锁：排他锁不允许其他事务读取或写入同一数据。当一个事务获取了一个数据的排他锁时，其他事务必须等待该事务释放锁才能访问该数据。MySQL中的排他锁是一种表锁。</li>
</ol>
<p>需要注意的是，锁机制虽然能够保证数据的正确性和一致性，但是也会带来一些负面影响，比如锁定冲突会导致事务的阻塞和等待，从而影响数据库的性能。因此，在使用锁机制时，需要根据实际情况进行权衡和调整。</p>
<h6 id="MyISQM表的表级锁"><a href="#MyISQM表的表级锁" class="headerlink" title="MyISQM表的表级锁"></a>MyISQM表的表级锁</h6><p>MySQL中的表级锁主要有两种类型：表共享读锁（Table Read Lock）和表排他写锁（Table Write Lock），它们都是一种表级锁。</p>
<ol>
<li>表共享读锁（Table Read Lock）：也称为表共享锁（Table Shared Lock），简称S锁。当一个事务获取了一个表的共享读锁后，其他事务也可以获取该表的共享读锁，但是不能获取该表的排他写锁。表共享锁可以防止其他事务在该表上执行写操作，但是允许其他事务读取该表的数据。在MySQL中，可以使用<code>LOCK TABLES ... READ</code>语句获取一个表的共享读锁。</li>
<li>表排他写锁（Table Write Lock）：也称为表排他锁（Table Exclusive Lock），简称X锁。当一个事务获取了一个表的排他写锁后，其他事务既不能获取该表的共享读锁，也不能获取该表的排他写锁。表排他写锁可以防止其他事务在该表上执行任何读写操作，保证了数据的完整性和一致性。在MySQL中，可以使用<code>LOCK TABLES ... WRITE</code>语句获取一个表的排他写锁。</li>
</ol>
<p>需要注意的是，表级锁是一种比较粗粒度的锁，锁住的是整个表，而不是某个数据行或者某个数据块。因此，在并发访问量较大的情况下，表级锁容易导致事务的阻塞和等待，从而影响数据库的性能。因此，在实际应用中，尽量使用行级锁来代替表级锁，可以有效提高数据库的并发处理能力。</p>
<h6 id="InnoDB表的行级锁"><a href="#InnoDB表的行级锁" class="headerlink" title="InnoDB表的行级锁"></a>InnoDB表的行级锁</h6><p>InnoDB是MySQL中一个常用的存储引擎，支持行级锁。与表级锁不同，行级锁只锁住数据表中的某一行数据，而不是整个数据表。这使得多个事务可以在同一时间内并发地访问同一张表中的不同行，从而提高了数据库的并发处理能力和性能。</p>
<p>InnoDB中的行级锁有两种类型：共享锁（Shared Lock）和排他锁（Exclusive Lock）。</p>
<ol>
<li>共享锁（Shared Lock）：共享锁也称为读锁，简称S锁。当一个事务获取了某一行数据的共享锁后，其他事务可以继续获取该行数据的共享锁，但是不能获取该行数据的排他锁。共享锁适用于多个事务读取同一行数据的情况，可以保证数据的一致性。在MySQL中，可以使用<code>SELECT ... FOR SHARE</code>语句获取一个或多个数据行的共享锁。</li>
<li>排他锁（Exclusive Lock）：排他锁也称为写锁，简称X锁。当一个事务获取了某一行数据的排他锁后，其他事务不能获取该行数据的共享锁或排他锁。排他锁适用于修改和删除数据的操作，可以保证数据的完整性和一致性。在MySQL中，可以使用<code>SELECT ... FOR UPDATE</code>、<code>UPDATE</code>和<code>DELETE</code>语句获取一个或多个数据行的排他锁。</li>
</ol>
<p>需要注意的是，在InnoDB中，行级锁是基于索引实现的。如果一张表没有索引，那么InnoDB就只能采用表级锁了。因此，在设计数据库表时，应该尽量为表添加索引，以便在需要使用行级锁时，可以使用索引来加锁，提高数据库的并发处理能力和性能。</p>
<h6 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h6><p>死锁是指两个或多个事务互相持有对方需要的资源，从而导致所有事务都无法继续执行下去的一种情况。简单来说，就是两个或多个事务互相等待对方释放锁，导致所有事务都被阻塞，无法完成。</p>
<p>在MySQL中，死锁通常发生在使用了行级锁的情况下。当多个事务同时访问同一张表中的不同行时，如果事务之间的加锁顺序不一致，就可能导致死锁的发生。例如，假设事务A需要获取行 和行2的排他锁，而事务B需要获取行2和行 的排他锁，那么就会出现死锁的情况。</p>
<p>为了避免死锁的发生，可以采取以下几种方式：</p>
<ol>
<li>尽量缩短事务的执行时间，减少锁的持有时间。</li>
<li>尽量减少事务中的查询数量和涉及的数据范围，避免锁的竞争。</li>
<li>尽量使用较低级别的隔离级别，例如可重复读取级别，避免行级锁的使用。</li>
<li>尽量保持事务的加锁顺序一致，避免死锁的发生。</li>
<li>尽量避免在事务中使用多个存储引擎，以免不同存储引擎之间的锁产生死锁。</li>
<li>在MySQL中，可以通过设置参数<code>innodb_deadlock_detect_interval</code>来控制死锁检测的时间间隔，减少死锁的发生。如果MySQL检测到死锁的存在，就会自动回滚其中一个事务，释放锁资源，避免死锁的继续存在。</li>
</ol>
<p>需要注意的是，死锁的发生是不可避免的，但是可以通过上述方法来尽量减少死锁的发生，并及时处理死锁，避免影响数据库的正常运行。</p>
<ol>
<li><p>什么是MySQL事务？ 答：MySQL事务是指一组SQL语句，这组SQL语句要么全部执行成功，要么全部执行失败。在MySQL中，事务主要用来保证数据的一致性和完整性。</p>
</li>
<li><p>MySQL中有哪些常见的隔离级别？ 答：MySQL中常见的隔离级别包括读未提交、读提交、可重复读和串行化四种级别。</p>
</li>
<li><p>什么是MySQL的行级锁？ 答：MySQL的行级锁是指针对某一行数据进行的加锁操作，只有持有该行的锁的事务才能对该行进行读写操作，其他事务则被阻塞。</p>
</li>
<li><p>什么是MySQL的表级锁？ 答：MySQL的表级锁是指针对整个表进行的加锁操作，只有持有该表的锁的事务才能对该表进行读写操作，其他事务则被阻塞。</p>
</li>
<li><p>什么是MySQL的死锁？如何避免MySQL的死锁？ 答：MySQL的死锁是指两个或多个事务互相持有对方需要的资源，从而导致所有事务都无法继续执行下去的一种情况。为了避免死锁的发生，可以采取缩短事务执行时间、减少查询数量和数据范围、使用较低级别的隔离级别、保持事务加锁顺序一致、避免使用多个存储引擎等方法。</p>
</li>
<li><p>什么是MySQL的事务控制语句？ 答：MySQL的事务控制语句主要包括BEGIN、COMMIT和ROLLBACK三个语句。其中，BEGIN用于开始一个事务，COMMIT用于提交一个事务，ROLLBACK用于回滚一个事务。</p>
</li>
<li><p>什么是MySQL事务的ACID特性？分别解释一下这四个特性的含义。 答：MySQL事务的ACID特性指原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability）四个特性。其中，原子性指一个事务中的所有操作要么全部执行成功，要么全部执行失败；一致性指事务执行前后，数据的完整性和一致性必须得到保证；隔离性指多个事务同时执行时，彼此之间是相互隔离的；持久性指事务执行成功后，所做的修改会被持久地保存在数据库中，即使系统崩溃也不会丢失。</p>
</li>
<li><p>什么是MySQL的锁机制？请列举MySQL中常见的锁。 答：MySQL的锁机制是指对数据库中的数据进行加锁，保证多个事务对同一数据进行并发访问时，数据的一致性和完整性。MySQL中常见的锁包括表级锁、行级锁、共享锁、排他锁、意向锁等。</p>
</li>
<li><p>什么是MySQL的行级锁？请解释一下如何使用行级锁来解决并发访问冲突的问题。 答：MySQL的行级锁是指对某一行数据进行的加锁操作，只有持有该行的锁的事务才能对该行进行读写操作，其他事务则被阻塞。通过使用行级锁，可以避免多个事务同时对同一行进行修改的情况，从而保证了数据的一致性和完整性。通常情况下，可以使用SELECT…FOR UPDATE语句来获取行级排他锁，或者使用SELECT…LOCK IN SHARE MODE语句来获取行级共享锁。</p>
</li>
<li><p>什么是MySQL的事务隔离级别？请解释一下在不同的隔离级别下会出现哪些问题。 答：MySQL的事务隔离级别是指多个事务之间彼此隔离的程度。MySQL中常见的隔离级别包括读未提交、读提交、可重复读和串行化四种级别。不同的隔离级别会导致不同的问题，例如在读未提交级别下会出现脏读问题，即读取到未提交的数据；在读提交级别下会出现不可重复读问题，即在同一事务中，不同时间点读取到的数据可能不一致；在可重复读级别下会出现幻读问题，即在同一事务中，相同的查询语句返回的结果可能不一致；在串行化级别下可以解决</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Fine</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/02/22/2023-02-22-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0/">http://example.com/2023/02/22/2023-02-22-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Strawberry</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="/-https:/source.fomal.cc/img/default_cover_11.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/01/31/ctfshow_web%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB78~82/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/-https:/source.fomal.cc/img/default_cover_11.webp" onerror="onerror=null;src='https://source.fomal.cc/img/default_cover_19.webp'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ctfshow_web入门（文件包含78-81）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://q2.qlogo.cn/headimg_dl?dst_uin=1493199807&amp;spec=100" onerror="this.onerror=null;this.src='https://source.fomal.cc/img/default_cover_10.webp'" alt="avatar"/></div><div class="author-info__name">Fine</div><div class="author-info__description">不要慌 不要慌 太阳下山有月光</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:1493199807@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">我好像走错了星球，这里的狐狸和花都不会说话</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0"><span class="toc-text">数据库复习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-%E4%BA%8B%E5%8A%A1%E4%B8%8EMySql%E7%9A%84%E5%A4%9A%E7%94%A8%E6%88%B7%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-text">第十四章 事务与MySql的多用户并发控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-text">.MySQL的事务</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%9C%AA%E6%8F%90%E4%BA%A4%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">读取未提交的数据</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%8F%90%E4%BA%A4%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">读取提交的数据</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E5%8F%96"><span class="toc-text">可重复读取</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-text">串行化</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-MySQL%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-text">2.MySQL事务控制语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7%E7%BA%A7%E5%88%AB"><span class="toc-text">3.事务的隔离性级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-MySQL%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-text">4.MySQL并发控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%94%81%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-text">5.锁的概述</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#MyISQM%E8%A1%A8%E7%9A%84%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-text">MyISQM表的表级锁</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#InnoDB%E8%A1%A8%E7%9A%84%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-text">InnoDB表的行级锁</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-text">死锁</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2003 - 2023 By Fine</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async src="/js/title.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"dispaly":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>